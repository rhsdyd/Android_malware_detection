import fnmatch
import os.path
import numpy as np
from androguard.misc import AnalyzeAPK

## get list of apk file
source_folder_path = '/home/ubung/Documents/master/apk/source'
benign_path = 'bn'
malware_path = 'mw'
file_list = os.listdir(source_folder_path + '/' + benign_path)

## Run extraction process if the file format is .apk

for file in file_list:
    if fnmatch.fnmatch(file, '*.apk'):
        print("Run Feature extraction from {}".format(file))
    else:
        print("wrong file format")



a, d, dx = AnalyzeAPK(source_folder_path + '/' + benign_path + '/' + file_list[1])

dx.get_classes()
a.get_android_manifest_axml().get_xml()
a.get_package()
a.get_android_manifest_axml().get_xml()

def printIntentFilters(itemtype, name):
    print ('\t' + name + ':')
    for action,intent_name in a.get_intent_filters(itemtype, name).items():
                print ('\t\t' + action + ':')
                for intent in intent_name:
                        print ('\t\t\t' + intent)
    return

# Intent filters
print('\nServices and their intent-filters:')
services = a.get_services()
serviceString = 'service'
for service in services:
    printIntentFilters(serviceString, service)
print('\nReceivers and their intent-filters:')
receivers = a.get_receivers()
receiverString = 'receiver'
for receiver in receivers:
    printIntentFilters(receiverString, receiver)

a.get_receivers()
APIs = dx.get_external_classes()