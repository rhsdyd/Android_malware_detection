# Android_malware_detection
This is a tool for android malware detection with following functions:
1. Static Features extraction from Android APK
2. Turn extracted features to Binary-vector matrix
3. Compare various feature selection algorithms and machine learning algorithms
4. Generate the classifier model with the best combination of feature selection and machine learning

**Working with MongoBD is highly recommended rather than CSV.**
### APK collection
Source: [AndroZoo](https://androzoo.uni.lu/)
- List of APKs (CSV file Androzoo): 
    - vt_detection (column) : The number of AV(Anti-Virus) from VirusTotal (VT) that detected this apks as a malware 
    - if vt_detection = 0 : Benign
    - if vt_detection > 0 : Malware
- Bulk download of APKs via API : [azoo](https://github.com/ArtemKushnerov/az)

## Static Feature Extraction
we need Reversing Engineering techniques for Static analysis.
For that, [Androguard](https://androguard.readthedocs.io/en/latest/) is used.

Categories of Features:
- AndroidManifest.xml
    - Permissions
    - Activities
    - Services
    - Receivers
- decompiled DEX to Java
    - Java Classes of API Call
    - Java Methods of API Call

Output:
Output can be a CSV file and forwarded to MySQL Database
Output table structur
- App name : the name of APK name
- Label : either Benign or Malware
- feature : Json of feature sets

### How to use
For further steps, Source file for APK have to follow this structure.
```
- source 
    ├── benign        # Benigh APKs
    ├── malware       # Malware APKs

```
#### Local environment
PREREQUISITES
- Python 3.6 or newer
- MongoDB

    ```sh
    $ python feature_extraction.py <Arguemtns>
    ```
There are different arguments
* `-h`: Show the help message and exit.
* `-S`, `--source`: directory of source file(e.g., /DIR/source)
* `-db`, `--database`: boolean / whether use MongoDB or not (optional)

Example: 
- `$ python feature_extraction.py -s /DIR/source -db` : with database(output:csv and dbl)
- `$ python feature_extraction.py -s /DIR/source `: no database(output:only csv)

SQL connection information(**db.py**)
   ```    
    conn = pymongo.MongoClient(host='HOST_NAME',
                               port=PORT,
                               username='USER_NAME',
                               password='PASSWORD', )

    database = 'DATABASE_NAME'
   ```



#### Docker
Note: source file has to be in this application directory.
1. to build and start the containers 
    ```    
     $ docker-compose up -d --build
    ```
2. RUN
    ```
     $ docker-compose run appDetector python feature_extraction.py -s <source_file_name> -db
    ```
## Feature vectorization
Change dataset to binary-vector matrix for each feature type
### How to use
#### Docker
    ```
     $ docker-compose run appDetector python feature_vectorization.py -i {csv / db} <output arguments>
    ```
There are different arguments
* `-h`: Show the help message and exit.
* `-i`, `--inputSource`: input source either csv or db
* `--ouputCSV`: output CSV (optional)
* `--ouputDB`: output DB (optional)